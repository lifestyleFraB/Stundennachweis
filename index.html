<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WorkTrack Pro - Frank Berndt</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        :root {
            --bg: #0f111a; --card-bg: #1a1c2e; --accent: #7289da;
            --text: #ffffff; --success: #43b581; --danger: #f04747; --text-dim: #949cf7; --edit: #f39c12;
        }
        body { font-family: 'Segoe UI', sans-serif; background: var(--bg); color: var(--text); margin: 0; padding: 15px; display: flex; flex-direction: column; align-items: center; }
        
        .app-header { width: 100%; max-width: 850px; padding: 10px; margin-bottom: 10px; border-left: 3px solid var(--accent); font-size: 0.9rem; color: var(--text-dim); }
        .nav { display: flex; flex-wrap: wrap; gap: 8px; margin-bottom: 20px; width: 100%; max-width: 850px; }
        .nav-btn { flex: 1; min-width: 80px; padding: 12px; cursor: pointer; border-radius: 10px; border: 1px solid var(--accent); background: transparent; color: var(--text); font-weight: bold; font-size: 0.75rem; }
        .nav-btn.active { background: var(--accent); }

        .container { width: 100%; max-width: 850px; display: none; background: var(--card-bg); padding: 25px; border-radius: 15px; box-sizing: border-box; }
        .container.active { display: block; }

        .timer-card { background: linear-gradient(135deg, #2c2f48 0%, #1a1c2e 100%); padding: 20px; border-radius: 15px; text-align: center; margin-bottom: 20px; border: 1px solid var(--accent); }
        .timer-display { font-size: 2.5rem; font-weight: bold; font-family: monospace; margin: 10px 0; color: var(--success); }
        .timer-controls { display: flex; gap: 10px; justify-content: center; }
        .t-btn { padding: 10px 20px; border-radius: 8px; border: none; font-weight: bold; cursor: pointer; color: white; }
        
        .summary-table { width: 100%; border-collapse: collapse; margin-top: 15px; background: rgba(255,255,255,0.05); border-radius: 10px; overflow: hidden; }
        .summary-table th, .summary-table td { padding: 12px; text-align: left; border-bottom: 1px solid #333; }
        .total-row { background: rgba(67, 181, 129, 0.2) !important; font-weight: bold; }

        input, select { width: 100%; padding: 12px; border-radius: 8px; border: 1px solid #333; background: #2c2f48; color: white; margin-bottom: 15px; box-sizing: border-box; }
        .btn-primary { background: var(--accent); color: white; width: 100%; padding: 15px; border-radius: 10px; border: none; font-weight: bold; cursor: pointer; }
        
        .week-block { background: rgba(255,255,255,0.03); margin-bottom: 30px; border-radius: 12px; border: 1px solid #333; overflow: hidden; }
        .week-title { background: #1f2235; padding: 12px 15px; font-weight: bold; color: var(--accent); }
        .report-table { width: 100%; border-collapse: collapse; font-size: 0.85rem; }
        .report-table th, .report-table td { padding: 10px; text-align: left; border-bottom: 1px solid #222; }
        .math-detail { padding: 15px; background: rgba(67, 181, 129, 0.1); border-top: 1px solid #333; font-size: 0.9rem; }

        #pdf-export-container { position: absolute; left: -9999px; }
        .pdf-area { width: 210mm; padding: 20mm; background: white; color: black; font-family: Arial, sans-serif; }

        /* Print Header & Footer Initial Hidden */
        .print-header, .print-footer { display: none; }

        @media print {
            body * { visibility: hidden; background: white !important; color: black !important; }
            #tab-report, #tab-report * { visibility: visible; }
            .print-header, .print-footer { display: block !important; }
            
            #tab-report button, #tab-report input, .nav, .app-header, 
            #report-dynamic-title, td:last-child, th:last-child { display: none !important; }

            #tab-report { position: absolute; left: 0; top: 0; width: 100%; margin: 0; padding: 0; }
            .week-block { border: 1px solid #ddd; margin-bottom: 20px; page-break-inside: avoid; }
            .summary-table { width: 100% !important; border-collapse: collapse; }
            .summary-table th, .summary-table td { border: 1px solid #ddd !important; padding: 8px; }
            .total-row { background-color: #f0f0f0 !important; }
        }
    </style>
    <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#000000">
</head>

<body>

    <h2 id="main-title" style="text-align: center; color: var(--accent); margin-top: 10px;">
        Stundennachweis Busbetrieb Elkmann - <span id="current-month-year"></span>
    </h2>

    <div class="app-header">
        <strong>Frank Berndt</strong> | Sellen 22 | 48565 Steinfurt
    </div>

    <div class="nav">
        <button id="nav-dash" class="nav-btn active" onclick="showTab('tab-dash')">Dashboard</button>
        <button id="nav-entry" class="nav-btn" onclick="showTab('tab-entry')">Erfassung</button>
        <button id="nav-report" class="nav-btn" onclick="showTab('tab-report')">Bericht & Export</button>
    </div>

    <div id="tab-dash" class="container active">
        <div class="timer-card">
            <h4 id="timer-status">Bereit f√ºr die n√§chste Tour</h4>
            <div class="timer-display" id="stopwatch">00:00:00</div>
            <div class="timer-controls">
                <button id="btn-start" class="t-btn" style="background:var(--success)" onclick="startTimer()">Start</button>
                <button id="btn-stop" class="t-btn" style="background:var(--danger); display:none;" onclick="stopTimer()">Beenden</button>
            </div>
            <select id="timer-tour-sel" style="margin-top:15px; margin-bottom:0;"></select>
        </div>
        <h3>Tour-√úbersicht</h3>
        <div id="dash-summary-content"></div>
        <div style="background: rgba(255,255,255,0.05); padding: 15px; border-radius: 12px; margin-top: 20px;">
            <h4>Touren verwalten</h4>
            <div style="display:flex; gap:10px;">
                <input type="text" id="new-tour-name" placeholder="Name der Tour..." style="margin-bottom:0;">
                <button onclick="addTour()" style="background:var(--success); border:none; padding:10px 20px; border-radius:8px; color:white; font-weight:bold;">+</button>
            </div>
            <div id="tour-list" style="margin-top:10px; font-size:0.9rem;"></div>
        </div>
    </div>

    <div id="tab-entry" class="container">
        <h3 id="form-title">Tourzeit erfassen</h3>
        <label>Tour ausw√§hlen</label><select id="sel-tour"></select>
        <label>Datum</label><input type="date" id="in-date">
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <div><label>Vormittag</label><div style="display:flex;gap:5px;"><input type="time" id="am-s" value="00:00"><input type="time" id="am-e" value="00:00"></div></div>
            <div><label>Nachmittag</label><div style="display:flex;gap:5px;"><input type="time" id="pm-s" value="00:00"><input type="time" id="pm-e" value="00:00"></div></div>
        </div>
        <button class="btn-primary" onclick="saveEntry()">Speichern</button>
        <button id="btn-cancel" onclick="resetForm()" style="display:none; width:100%; margin-top:10px; background:#444; color:white; border:none; padding:10px; border-radius:10px;">Abbrechen / Zur√ºcksetzen</button>
    </div>

    <div id="tab-report" class="container">
        <div class="print-header">
            <div style="text-align: center; border-bottom: 2px solid #000; padding-bottom: 10px; margin-bottom: 20px;">
                <h1 style="margin: 0; font-size: 18pt;">Stundennachweis Busbetrieb Elkmann</h1>
                <h2 id="print-month-year" style="margin: 5px 0; font-size: 14pt;"></h2>
            </div>
            <div style="display: flex; justify-content: space-between; margin-bottom: 20px; font-size: 10pt;">
                <div><strong>Fahrer:</strong> Frank Berndt<br>Sellen 22 | 48565 Steinfurt<br> Mobil: 01725374047</div>
                <div style="text-align: right;"><strong>Erstellt am:</strong> <span id="print-current-date"></span></div>
            </div>
        </div>

        <div id="report-list"></div>
        
        <div id="report-final-summary-box" style="margin-top:30px; border-top:2px solid var(--accent); padding-top:15px;">
            <h4 id="report-dynamic-title">Gesamt-Abrechnung</h4>
            <div id="report-final-table"></div>
        </div>

        <div class="print-footer" style="margin-top: 50px; display: flex; justify-content: space-between;">
            <div style="border-top: 1px solid #000; width: 60mm; text-align: center; font-size: 9pt; padding-top: 5px;">Unterschrift Frank Berndt</div>
            <div style="border-top: 1px solid #000; width: 60mm; text-align: center; font-size: 9pt; padding-top: 5px;">Best√§tigung Betrieb</div>
        </div>

        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px; margin-top:20px;">
            <button onclick="generatePDF()" style="background:var(--danger); color:white; border:none; padding:15px; border-radius:10px; font-weight:bold; cursor:pointer;">PDF Beleg</button>
            <button onclick="exportCSV()" style="background:var(--success); color:white; border:none; padding:15px; border-radius:10px; font-weight:bold; cursor:pointer;">Excel Export</button>
        </div>
        <button onclick="window.print()" style="background:#444; color:white; border:none; padding:15px; border-radius:10px; font-weight:bold; cursor:pointer; width:100%; margin-top:10px;">System-Druck (Alternative)</button>
    </div>

    <div style="margin-top: 20px; padding: 15px; border-top: 1px dashed var(--accent); width: 100%; max-width: 850px; box-sizing: border-box;">
        <h4>Daten-Sicherung</h4>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap:10px;">
            <button onclick="backupData()" style="background:#5865f2; color:white; border:none; padding:10px; border-radius:8px; font-weight:bold; cursor:pointer;">Sichern (Download)</button>
            <button onclick="document.getElementById('import-file').click()" style="background:#4e5058; color:white; border:none; padding:10px; border-radius:8px; font-weight:bold; cursor:pointer;">Wiederherstellen</button>
        </div>
        <input type="file" id="import-file" style="display:none" onchange="restoreData(event)" accept=".json">
    </div>

    <div id="pdf-export-container"><div id="pdf-area" class="pdf-area"></div></div>

<script>
    let db = JSON.parse(localStorage.getItem('frank_v24')) || { entries: [], tours: ["Standard-Tour"], activeTimer: null };
    let timerInterval;
    let editId = null;

    function init() {
        const mj = getMonatJahr();
        document.getElementById('current-month-year').innerText = mj;
        updateTourDropdowns();
        renderDashboard();
        updateTimerUI();
        document.getElementById('in-date').valueAsDate = new Date();
    }

    function saveDB() { localStorage.setItem('frank_v24', JSON.stringify(db)); }

    function startTimer() {
        db.activeTimer = { start: Date.now(), tour: document.getElementById('timer-tour-sel').value };
        saveDB();
        updateTimerUI();
    }

    function stopTimer() {
        const startTime = db.activeTimer.start;
        const endTime = Date.now();
        const tour = db.activeTimer.tour;
        showTab('tab-entry');
        document.getElementById('sel-tour').value = tour;
        document.getElementById('am-s').value = new Date(startTime).toTimeString().slice(0,5);
        document.getElementById('am-e').value = new Date(endTime).toTimeString().slice(0,5);
        db.activeTimer = null;
        saveDB();
        updateTimerUI();
    }

    function updateTimerUI() {
        const btnStart = document.getElementById('btn-start');
        const btnStop = document.getElementById('btn-stop');
        const display = document.getElementById('stopwatch');
        const status = document.getElementById('timer-status');
        if(db.activeTimer) {
            btnStart.style.display = "none"; btnStop.style.display = "inline-block";
            status.innerText = "Tour l√§uft: " + db.activeTimer.tour;
            if(!timerInterval) {
                timerInterval = setInterval(() => {
                    const diff = Date.now() - db.activeTimer.start;
                    const h = Math.floor(diff/3600000).toString().padStart(2,'0');
                    const m = Math.floor((diff%3600000)/60000).toString().padStart(2,'0');
                    const s = Math.floor((diff%60000)/1000).toString().padStart(2,'0');
                    display.innerText = `${h}:${m}:${s}`;
                }, 1000);
            }
        } else {
            clearInterval(timerInterval); timerInterval = null;
            btnStart.style.display = "inline-block"; btnStop.style.display = "none";
            display.innerText = "00:00:00"; status.innerText = "Bereit f√ºr die n√§chste Tour";
        }
    }

    function renderReport() {
        const mj = getMonatJahr();
        document.getElementById('print-month-year').innerText = mj;
        document.getElementById('print-current-date').innerText = new Date().toLocaleDateString('de-DE');
        document.getElementById('report-dynamic-title').innerText = `Stundennachweis ${mj} f√ºr Busbetrieb Elkmann`;

        const weeks = {};
        db.entries.forEach(e => {
            const key = `${e.year}-KW${e.kw}-${e.tour}`;
            if(!weeks[key]) weeks[key] = { items: [], h: 0, days: new Set() };
            weeks[key].items.push(e); weeks[key].h += e.total; weeks[key].days.add(e.date);
        });

        let html = '';
        for(let k in weeks) {
            const w = weeks[k], count = w.days.size, avg = w.h / count;
            html += `<div class="week-block"><div class="week-title">${k.split('-KW')[1].split('-')[0]}. KW | Tour: ${k.split('-').slice(2).join('-')}</div>
                <table class="report-table"><thead><tr><th>Datum</th><th>Vorm.</th><th>Nachm.</th><th>Std.</th><th></th></tr></thead>
                <tbody>${w.items.map(i => `<tr><td>${i.date}</td><td>${i.am_s}-${i.am_e}</td><td>${i.pm_s}-${i.pm_e}</td><td><b>${i.total.toFixed(2)}</b></td>
                <td style="text-align:right"><span onclick="editEntry(${i.id})" style="color:var(--edit);margin-right:10px;cursor:pointer;">‚úé</span><span onclick="deleteEntry(${i.id})" style="color:var(--danger);cursor:pointer;">üóë</span></td></tr>`).join('')}</tbody>
                </table>
                <div class="math-detail">Abrechnung: ${w.h.toFixed(2)}h / ${count} Tage = ${avg.toFixed(2)}h √ò | <strong>${(w.h * 14).toFixed(2)} ‚Ç¨</strong></div></div>`;
        }
        document.getElementById('report-list').innerHTML = html || "Keine Eintr√§ge.";
        document.getElementById('report-final-table').innerHTML = getSummaryHTML();
    }

function getSummaryHTML() {
    const stats = {}; let totalH = 0;
    db.entries.forEach(e => {
        if(!stats[e.tour]) stats[e.tour] = { h: 0 };
        stats[e.tour].h += e.total; totalH += e.total;
    });

    let html = `
    <table class="summary-table" style="width: 100%; border-collapse: collapse; font-family: monospace;">
        <thead>
            <tr style="border-bottom: 2px solid #ddd;">
                <th style="text-align: left; padding: 8px;">Tour-Bezeichnung</th>
                <th style="text-align: right; padding: 8px; width: 80px;">Stunden</th>
                <th style="text-align: right; padding: 8px; width: 100px;">Verdienst</th>
            </tr>
        </thead>
        <tbody>`;
    
    for(let t in stats) { 
        html += `
            <tr>
                <td style="padding: 8px; border-bottom: 1px solid #eee;">${t}</td>
                <td style="text-align: right; padding: 8px; border-bottom: 1px solid #eee;">${stats[t].h.toFixed(2)} h</td>
                <td style="text-align: right; padding: 8px; border-bottom: 1px solid #eee;">${(stats[t].h * 14).toFixed(2)} ‚Ç¨</td>
            </tr>`; 
    }
    
    html += `
            <tr class="total-row" style="background-color: #e6e6e6; font-weight: bold;">
                <td style="padding: 8px;">GESAMT-SUMME</td>
                <td style="text-align: right; padding: 8px;">${totalH.toFixed(2)} h</td>
                <td style="text-align: right; padding: 8px;">${(totalH * 14).toFixed(2)} ‚Ç¨</td>
            </tr>
        </tbody>
    </table>`;
    return html;
}

    function exportCSV() {
        if (db.entries.length === 0) return alert("Keine Daten!");
        let csv = "Datum;Tour;Vormittag;Nachmittag;Stunden\n";
        db.entries.forEach(e => {
            csv += `${e.date};${e.tour};${e.am_s}-${e.am_e};${e.pm_s}-${e.pm_e};${e.total.toFixed(2).replace('.',',')}\n`;
        });
        const blob = new Blob(["\ufeff" + csv], { type: 'text/csv;charset=utf-8;' });
        const link = document.createElement("a");
        link.href = URL.createObjectURL(blob);
        link.download = `Stundennachweis_${getMonatJahr().replace(' ','_')}.csv`;
        link.click();
    }

async function generatePDF() {
    renderReport();
    const mj = getMonatJahr();
    const area = document.getElementById('pdf-area');
    
    // Hintergrundfarbe auf hellgrau (#e0e0e0 = ca 20% schwarz)
    const grau20 = "#e0e0e0";

    area.innerHTML = `
        <div style="padding: 10mm; font-family: Arial, sans-serif; color: #000; background-color: #ffffff; width: 190mm;">
            
            <div style="text-align: center; background-color: ${grau20} !important; -webkit-print-color-adjust: exact; padding: 15px; border-radius: 5px; margin-bottom: 20px; border: 1px solid #ccc;">
                <h1 style="margin: 0; font-size: 18pt; color: #000;">Stundennachweis Busbetrieb Elkmann</h1>
                <h2 style="margin: 5px 0; font-size: 14pt; color: #333;">${mj}</h2>
            </div>

            <div style="display: flex; justify-content: space-between; margin-bottom: 20px; font-size: 10pt;">
                <div>
                    <strong>Fahrer:</strong><br>
                    Frank Berndt<br>
                    Sellen 22 | 48565 Steinfurt<br>
                    <strong>Mobil: 0172-5374047</strong>
                </div>
                <div style="text-align: right;">
                    <strong>Erstellt am:</strong><br>
                    ${new Date().toLocaleDateString('de-DE')}
                </div>
            </div>

            <div id="pdf-content-inject"></div>

            <div style="margin-top: 30px; border: 1px solid #ddd; page-break-inside: avoid;">
                <div style="background-color: ${grau20} !important; -webkit-print-color-adjust: exact; padding: 10px; border-bottom: 1px solid #ddd;">
                    <h3 style="margin: 0; font-size: 12pt; color: #000;">Gesamt-Zusammenfassung (Netto-Abrechnung)</h3>
                </div>
                <div id="pdf-summary-inject" style="padding: 0;"></div>
            </div>

            <div style="margin-top: 50px; display: flex; justify-content: space-between; page-break-inside: avoid;">
                <div style="border-top: 1px solid #000; width: 65mm; text-align: center; font-size: 9pt; padding-top: 5px;">Unterschrift Frank Berndt</div>
                <div style="border-top: 1px solid #000; width: 65mm; text-align: center; font-size: 9pt; padding-top: 5px;">Best√§tigung Betrieb</div>
            </div>
        </div>
    `;

    // Daten einf√ºgen
    area.querySelector('#pdf-summary-inject').innerHTML = getSummaryHTML();
    const reportContent = document.getElementById('report-list').cloneNode(true);
    reportContent.querySelectorAll('td:last-child, th:last-child').forEach(el => el.remove());
    area.querySelector('#pdf-content-inject').appendChild(reportContent);

    // Tabellen-Design anpassen (Kein Schwarz!)
    area.querySelectorAll('table').forEach(table => {
        table.style.width = "100%";
        table.style.borderCollapse = "collapse";
        
        table.querySelectorAll('th').forEach(th => {
            th.style.backgroundColor = grau20;
            th.style.color = "#000";
            th.style.border = "1px solid #ccc";
            th.style.padding = "8px";
        });

        table.querySelectorAll('td').forEach(cell => {
            cell.style.border = "1px solid #ddd";
            cell.style.padding = "8px";
            cell.style.color = "#000";
        });
    });

    // Summenzeile in der Tabelle ebenfalls grau f√§rben
    const trTotal = area.querySelector('.total-row');
    if(trTotal) {
        trTotal.style.backgroundColor = grau20 + " !important";
        trTotal.style.color = "#000";
    }

    // PDF Erstellung
    const canvas = await html2canvas(area, { 
        scale: 2, 
        logging: false, 
        useCORS: true,
        backgroundColor: "#ffffff" 
    });
    
    const imgData = canvas.toDataURL('image/png');
    const pdf = new jspdf.jsPDF('p', 'mm', 'a4');
    const imgWidth = 210;
    const imgHeight = (canvas.height * imgWidth) / canvas.width;
    const pageHeight = 297;
    let heightLeft = imgHeight;
    let position = 0;

    pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
    heightLeft -= pageHeight;

    while (heightLeft >= 0) {
        position = heightLeft - imgHeight;
        pdf.addPage();
        pdf.addImage(imgData, 'PNG', 0, position, imgWidth, imgHeight);
        heightLeft -= pageHeight;
    }

    pdf.save(`Stundennachweis_Frank_Berndt_${mj.replace(' ','_')}.pdf`);
    area.innerHTML = "";
}

    // Hilfsfunktionen
    function showTab(id) {
        document.querySelectorAll('.container').forEach(c => c.classList.remove('active'));
        document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
        document.getElementById(id).classList.add('active');
        document.getElementById('nav-' + id.split('-')[1]).classList.add('active');
        if(id === 'tab-report') renderReport();
        if(id === 'tab-dash') renderDashboard();
    }
    function getMonatJahr() {
        const monate = ["Januar", "Februar", "M√§rz", "April", "Mai", "Juni", "Juli", "August", "September", "Oktober", "November", "Dezember"];
        const now = new Date(); return `${monate[now.getMonth()]} ${now.getFullYear()}`;
    }
    function updateTourDropdowns() {
        const options = db.tours.map(t=>`<option value="${t}">${t}</option>`).join('');
        document.getElementById('sel-tour').innerHTML = options;
        document.getElementById('timer-tour-sel').innerHTML = options;
    }
    function addTour() { const n = document.getElementById('new-tour-name').value.trim(); if(n && !db.tours.includes(n)) { db.tours.push(n); saveDB(); init(); } }
    function deleteTour(n) { if(confirm("L√∂schen?")) { db.tours=db.tours.filter(t=>t!==n); saveDB(); init(); } }
    function getKW(d) { d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate())); d.setUTCDate(d.getUTCDate() + 4 - (d.getUTCDay()||7)); return Math.ceil((((d - new Date(Date.UTC(d.getUTCFullYear(),0,1))) / 86400000) + 1)/7); }
    function saveEntry() {
        const am_s = document.getElementById('am-s').value, am_e = document.getElementById('am-e').value, pm_s = document.getElementById('pm-s').value, pm_e = document.getElementById('pm-e').value;
        const total = ((new Date(`1970-01-01T${am_e}`) - new Date(`1970-01-01T${am_s}`)) + (new Date(`1970-01-01T${pm_e}`) - new Date(`1970-01-01T${pm_s}`))) / 3600000;
        const d = new Date(document.getElementById('in-date').value);
        const data = { id: editId || Date.now(), tour: document.getElementById('sel-tour').value, date: document.getElementById('in-date').value, kw: getKW(d), year: d.getFullYear(), am_s, am_e, pm_s, pm_e, total: Math.abs(total) };
        if(editId) db.entries[db.entries.findIndex(e=>e.id===editId)] = data; else db.entries.push(data);
        db.entries.sort((a,b) => new Date(a.date) - new Date(b.date));
        saveDB(); resetForm(); showTab('tab-report');
    }
    function editEntry(id) { const e = db.entries.find(x=>x.id===id); editId=id; document.getElementById('sel-tour').value=e.tour; document.getElementById('in-date').value=e.date; document.getElementById('am-s').value=e.am_s; document.getElementById('am-e').value=e.am_e; document.getElementById('pm-s').value=e.pm_s; document.getElementById('pm-e').value=e.pm_e; showTab('tab-entry'); document.getElementById('btn-cancel').style.display="block"; }
    function deleteEntry(id) { if(confirm("L√∂schen?")) { db.entries=db.entries.filter(x=>x.id!==id); saveDB(); renderReport(); } }
    function resetForm() { editId = null; document.getElementById('am-s').value = "00:00"; document.getElementById('am-e').value = "00:00"; document.getElementById('pm-s').value = "00:00"; document.getElementById('pm-e').value = "00:00"; document.getElementById('btn-cancel').style.display = "none"; }
    function backupData() {
        const blob = new Blob([JSON.stringify(db, null, 2)], { type: 'application/json' });
        const link = document.createElement('a'); link.href = URL.createObjectURL(blob); link.download = `WorkTrack_Backup_${new Date().toISOString().slice(0,10)}.json`; link.click();
    }
    function restoreData(event) {
        const reader = new FileReader();
        reader.onload = function(e) {
            try { db = JSON.parse(e.target.result); saveDB(); init(); alert("Erfolgreich!"); } catch(e) { alert("Fehler!"); }
        };
        reader.readAsText(event.target.files[0]);
    }

    init();
</script>
</body>
</html>
